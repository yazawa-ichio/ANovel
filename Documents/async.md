
# 非同期処理

## 共通
演出は非同期実行を標準の挙動をしています。  
そのため同時にキャラを表示する場合などに特別な命令は必要ありません。  
```
@chara name="キャラ1" face="表情1" time=200
@chara name="キャラ2" face="表情2" time=200

キャラ1とキャラ2が同時に表示されます。
また、テキストもキャラの表示演出中に表示されます。
```
※組み込みの実装が非同期にしてあるだけです。ユーザーが作成するコマンドでも行う場合は非同期フラグを設定する必要があります。

### 同期フラグ

syncフラグを有効にすると同期処理になり、そのコマンドが終了するまで次のコマンドが実行されません。  
syncと併用するcanskipフラグがありスキップが可能かを選べます。

```
;同期フラグを立てる
@chara name="キャラ1" face="表情1" time=1000 sync=true
;キーだけを入れるとvalueはtrue扱いになります。
@chara name="キャラ1" face="表情2" time=1000 sync canskip=false
```

## 非同期命令
コマンド単体では難しい同期・非同期制御を行うコマンドとして`parallel`と`async`があります。

### parallel
複数の命令を実行しつつ全体を同期で待ちたい場合はparallelコマンドを利用します。  
`&end` でまでのスコープ内のコマンドをすべて同時に実行します。  

```
&parallel
@chara name="キャラ1" face="表情1" time=1000 sync
@chara name="キャラ2" face="表情2" time=2000 sync
&end

本来キャラ1の表示が同期で止まりますがどちらも実行されます。
標準ではスコープの同期コマンド全て終了するまで同期待ちします。
```

### async
複数の同期コマンドを直列実行しつつ、全体を非同期にしたい場合はasyncコマンドを利用します。  
`&end` でまでのスコープ内に同期命令があっても、全体が非同期として扱われます。  

```
&async
@image name="画像" path="file1" sync
@wait time=500
@image name="画像" path="file2" sync
&end

本来同期命令があるとテキストの表示まで行かないが、asyncがあるのテキストの表示をしつつ演出が実行される。
ボイスに合わせて演出を行う場合になどに利用できます。  
```
